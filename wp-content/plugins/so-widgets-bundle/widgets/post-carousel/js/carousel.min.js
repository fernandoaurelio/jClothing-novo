var sowb=window.sowb||{};jQuery(function(y){sowb.setupCarousel=function(){y(".sow-carousel-wrapper").each(function(){var t=y(this),e=t.closest(".sow-carousel-container"),s=t.closest(".sow-carousel-container").parent(),n=t.find(".sow-carousel-items"),a=t.find(".sow-carousel-item"),o=a.eq(0),u=0,i=1,r=!1,l=a.length,c=t.data("found-posts"),w=l===c,f=o.width()+parseInt(o.css("margin-right")),d=e.hasClass("js-rtl"),p=d?"margin-right":"margin-left",h=function(){if(u<0&&(u=0),u>=t.find(".sow-carousel-item").length-1&&(u=t.find(".sow-carousel-item").length-1,!r&&!w)){r=!0,i++,n.append('<li class="sow-carousel-item sow-carousel-loading"></li>');var e=s.find('input[name="instance_hash"]').val();y.get(t.data("ajax-url"),{query:t.data("query"),action:"sow_carousel_load",paged:i,instance_hash:e},function(e,s){y(e.html).appendTo(n).hide().fadeIn(),t.find(".sow-carousel-loading").remove(),l=t.find(".sow-carousel-item").length,w=l===c,r=!1})}n.css("transition-duration","0.45s"),n.css(p,-f*u+"px")};if(s.on("click","a.sow-carousel-previous",function(e){e.preventDefault(),u-=d?-1:1,h()}),s.on("click","a.sow-carousel-next",function(e){e.preventDefault(),u+=d?-1:1,h()}),"function"==typeof t.swipe){var g,m=!1,v=0,b=0,D=0,I=0,T=d?"right":"left",x=function(e){return e<50&&-f*l<e&&(n.css("transition-duration","0s"),n.css(p,e+"px"),!0)},_=function(){var e=parseInt(n.css(p));u=Math.abs(Math.round(e/f)),h()};t.on("click",".sow-carousel-item a",function(e){m&&(e.preventDefault(),m=!1)}),t.swipe({excludedElements:"",triggerOnTouchEnd:!0,threshold:75,swipeStatus:function(e,s,n,a,t,o,i){if("up"===n||"down"===n)return!1;if("start"===s)b=-f*u,I=(new Date).getTime(),clearInterval(g);else if("move"===s){n===T&&(a*=-1),x(b+a);var r=(new Date).getTime();D=(a-v)/((r-I)/1e3),I=r,v=a}else if("end"===s)if(m=!0,n===T&&(a*=-1),400<Math.abs(D)){D*=.1;var l=(new Date).getTime(),c=0;g=setInterval(function(){var e=((new Date).getTime()-l)/1e3,s=b+a+(c+=D*e),t=Math.abs(D)-30<0;n===T?D+=30:D-=30,!t&&x(s)||(clearInterval(g),_())},20)}else _();else"cancel"===s&&h()}})}})},sowb.setupCarousel(),y(sowb).on("setup_widgets",sowb.setupCarousel)}),window.sowb=sowb;