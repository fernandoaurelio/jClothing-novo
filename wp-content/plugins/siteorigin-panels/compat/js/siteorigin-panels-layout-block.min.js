!function(e,t,n,i,o,a){var l=i.createElement,r=e.BlockControls,s=a.withState,d=o.Toolbar,p=o.IconButton,u=o.Spinner,c=n.__;t.registerBlockType("siteorigin-panels/layout-block",{title:c("SiteOrigin Layout","siteorigin-panels"),description:c("Build a layout using SiteOrigin's Page Builder.","siteorigin-panels"),icon:function(){return l("span",{className:"siteorigin-panels-block-icon"})},category:"layout",supports:{html:!1},attributes:{panelsData:{type:"object"}},edit:s({editing:!1,panelsInitialized:!1,loadingPreview:!1,previewInitialized:!1,previewHtml:""})(function(s){if(s.editing||!s.attributes.panelsData)return[l(r,{key:"controls"},l(d,null,l(p,{className:"components-icon-button components-toolbar__control",label:c("Preview layout.","siteorigin-panels"),onClick:function(){s.attributes.panelsData&&s.setState({editing:!1,previewInitialized:!1})},icon:"visibility"}))),l("div",{key:"pageBuilder",className:"siteorigin-panels-layout-block-container",ref:function(e){if(!s.panelsInitialized){var t=jQuery(e),n=new panels.model.builder,i=new panels.view.builder({model:n,config:{editorType:"standalone"}}),o=JSON.parse(JSON.stringify($.extend({},s.attributes.panelsData)));function a(){s.toggleSelection(!1),$(document).on("mouseup",function e(){s.toggleSelection(!0),$(document).off("mouseup",e)})}i.on("row_added",function(){i.$(".so-row-move").off("mousedown",a),i.$(".so-row-move").on("mousedown",a),i.$(".so-widget").off("mousedown",a),i.$(".so-widget").on("mousedown",a)}),i.on("widget_added",function(){i.$(".so-widget").off("mousedown",a),i.$(".so-widget").on("mousedown",a)}),i.render().attach({container:t}).setData(o),i.trigger("builder_resize"),i.on("content_change",function(){s.setAttributes({panelsData:i.getData()}),s.setState({previewInitialized:!1,previewHtml:""})}),$(document).trigger("panels_setup",i),s.setState({editing:!0,panelsInitialized:!0})}}})];var e=!s.editing&&!s.previewHtml&&s.attributes.panelsData;e&&$.post({url:soPanelsBlockEditorAdmin.previewUrl,data:{action:"so_panels_block_editor_preview",panelsData:JSON.stringify(s.attributes.panelsData)}}).then(function(e){s.setState({previewHtml:e,loadingPreview:!1})});var t=s.previewHtml?s.previewHtml:"";return[l(r,{key:"controls"},l(d,null,l(p,{className:"components-icon-button components-toolbar__control",label:c("Edit layout.","siteorigin-panels"),onClick:function(){s.setState({editing:!0,panelsInitialized:!1})},icon:"edit"}))),l("div",{key:"preview",className:"so-panels-block-layout-preview-container"},e?l("div",{className:"so-panels-spinner-container"},l("span",null,l(u))):l("div",{dangerouslySetInnerHTML:{__html:t},ref:function(){s.editing||($(document).trigger("panels_setup_preview"),window.sowb&&$(window.sowb).trigger("setup_widgets"))}}))]}),save:function(){return null}})}(window.wp.editor,window.wp.blocks,window.wp.i18n,window.wp.element,window.wp.components,window.wp.compose);